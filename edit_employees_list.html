<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>إدارة الموظفين - نور للإضاءة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet"/>
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; }
        .card-anim { animation: fadeInUp 0.4s ease forwards; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="p-6 text-right pb-20">
    <header class="max-w-md mx-auto flex items-center gap-4 mb-8">
        <button onclick="localStorage.removeItem('editing_now'); window.location.href='employee_management.html'" class="w-10 h-10 bg-white rounded-full shadow flex items-center justify-center border border-slate-100 active:scale-90 transition-transform">
            <span class="material-icons-round text-slate-600 text-sm">arrow_forward</span>
        </button>
        <h1 class="text-lg font-bold text-slate-800 italic uppercase">إدارة تعديل وحذف الموظفين</h1>
    </header>

    <main class="max-w-md mx-auto space-y-3">
        <div class="relative mb-6">
             <span class="material-icons-round absolute right-4 top-1/2 -translate-y-1/2 text-slate-400">search</span>
             <input id="searchInput" oninput="searchEmployees()" class="w-full bg-white border-none rounded-2xl py-4 pr-12 pl-4 text-xs font-bold shadow-sm focus:ring-2 focus:ring-purple-500 outline-none placeholder:text-slate-300" placeholder="ابحث باسم الموظف للتعديل..." type="text"/>
        </div>

        <div id="editListContainer" class="space-y-4 text-center py-10">
            <p class="text-slate-400 text-xs italic">جاري تحميل الموظفين من الذاكرة...</p>
        </div>
    </main>

    <script>
        // ١. تحميل الموظفين من الذاكرة الموحدة (nour_employees)
        function loadEmployeesToEdit() {
            // تأكدي من حرف الـ u هنا لربطها بصفحة الإضافة
            var employees = JSON.parse(localStorage.getItem('nour_employees')) || [];
            displayEmployees(employees);
        }

        // ٢. رسم الموظفين في الصفحة
        function displayEmployees(list) {
            var container = document.getElementById('editListContainer');
            
            if (list.length === 0) {
                container.innerHTML = '<div class="bg-white p-8 rounded-[2rem] border border-dashed border-slate-200 text-slate-400 text-xs font-bold italic">لا يوجد موظفين مسجلين حالياً بهذا الاسم</div>';
                return;
            }

            var html = "";
            for (var i = 0; i < list.length; i++) {
                var emp = list[i];
                var photoHtml = emp.photo ? 
                    '<img src="' + emp.photo + '" class="w-full h-full object-cover">' : 
                    '<span class="text-purple-600 font-black">' + (emp.name ? emp.name.substring(0, 1) : '?') + '</span>';

                html += '<div class="bg-white p-4 rounded-[2rem] shadow-sm border border-slate-50 flex items-center justify-between mb-3 card-anim">' +
                    '<div class="flex items-center gap-4">' +
                    '<div class="w-12 h-12 bg-purple-50 rounded-2xl flex items-center justify-center border border-purple-100 overflow-hidden shadow-inner text-xs uppercase">' +
                    photoHtml +
                    '</div>' +
                    '<div class="text-right">' +
                    '<h4 class="font-black text-sm text-slate-800 italic">' + emp.name + '</h4>' +
                    '<p class="text-[9px] text-slate-400 font-bold uppercase tracking-tighter">' + (emp.department || "قسم عام") + ' | راتب: ' + (emp.baseSalary || "0") + '</p>' +
                    '</div>' +
                    '</div>' +
                    '<div class="flex gap-2">' +
                    '<button onclick="goToEditPage(\'' + emp.name + '\')" class="bg-purple-600 text-white w-10 h-10 rounded-xl flex items-center justify-center shadow-lg shadow-purple-200 active:scale-90 transition-transform">' +
                    '<span class="material-icons-round text-lg">edit</span>' +
                    '</button>' +
                    '<button onclick="deleteEmployee(\'' + emp.name + '\')" class="bg-red-50 text-red-500 w-10 h-10 rounded-xl flex items-center justify-center border border-red-100 active:scale-90 transition-transform">' +
                    '<span class="material-icons-round text-lg">delete_outline</span>' +
                    '</button>' +
                    '</div>' +
                    '</div>';
            }
            container.innerHTML = html;
        }

        // ٣. دالة البحث اللحظي
        function searchEmployees() {
            var term = document.getElementById('searchInput').value.toLowerCase();
            var employees = JSON.parse(localStorage.getItem('nour_employees')) || [];
            var filtered = employees.filter(function(emp) {
                return emp.name.toLowerCase().includes(term);
            });
            displayEmployees(filtered);
        }

        // ٤. الانتقال لصفحة التعديل (إرسال البيانات لصفحة add_employee)
        function goToEditPage(empName) {
            // حفظ اسم الموظف لفتحه في صفحة الإضافة
            localStorage.setItem('editing_now', empName);
            window.location.href = 'add_employee.html';
        }

        // ٥. دالة الحذف المضمونة
        function deleteEmployee(empName) {
            if (confirm("يا مروة، هل أنتِ متأكدة من حذف الموظف: " + empName + "؟")) {
                var employees = JSON.parse(localStorage.getItem('nour_employees')) || [];
                
                // تصفية المصفوفة وحذف الموظف المطلوب
                var newList = employees.filter(function(e) { 
                    return e.name !== empName; 
                });
                
                // حفظ التغييرات فوراً في المخزن الموحد
                localStorage.setItem('nour_employees', JSON.stringify(newList));
                
                // إعادة تحميل القائمة أوتوماتيك
                loadEmployeesToEdit();
                alert("تم حذف الموظف بنجاح من قاعدة البيانات");
            }
        }

        window.onload = loadEmployeesToEdit;
    </script>
</body>
</html>